# 제8장 스레드 트리

## 개관

이진 트리를 순회할 때 자료가 되지 않고 지나쳐 온 노드들은 스택에 저장. 하지만 스택을 관리해야 하는 번거로움 존재. 이러한 번거로움을 없앤 트리가 스레드 트리. 정해진 순회 방법에 따른 방문 순서를 유지하는 포인터를 스레드라고 함. 그리고 스레드라는 포인터를 갖는 이진 트리를 스레드 트리라고 함.

스레드의 종류는 두 가지:
- **왼쪽 스레드**: 정해진 순서에 따른 그 노드의 후속 노드를 가리킴
- **오른쪽 스레드**: 그 노드의 선행 노드를 가리킴

## 학습 목표

1. 스레드 트리의 개념 이해
2. 스레드 트리의 구현 방법 이해  
3. 스레드 트리의 순회 연산과 삽입·삭제 연산 이해

## 용어 정리

- **스레드(thread)**: 정해진 순회 방법에 따른 방문 순서를 유지하는 포인터
- **스레드 트리**: 스레드라는 포인터를 갖는 이진 트리
- **오른쪽 스레드**: 정해진 순회 방법에 따른 그 노드의 후속 노드를 가리킴
- **왼쪽 스레드**: 그 노드의 선행 노드를 가리킴
- **이진 트리의 NULL 포인터 개수**: 2n-(n-1) = n+1개

---

## 1. 스레드 트리

### 스레드 트리의 필요성

이진 트리를 순회할 때 (자료가 되지 않아 다음을 기억하고) 방문하지 않은 채로 지나쳐 온 노드들은 스택에 저장하여 관리. 매우 번거로운 일. 이와는 달리 정해진 순회 방법에 따른 방문 순서를 유지하는 스레드(thread)라는 포인터를 사용하는 방법 존재. 이러한 스레드 포인터를 갖는 이진 트리를 스레드 트리라고 함.

### 연결 리스트와 스레드 트리의 관계

연결 리스트에서 원형 연결 리스트가 일반 연결 리스트보다 유용한 것처럼, 스레드 트리도 일반 이진 트리보다 순회에 유용.

### 스레드의 정의와 종류

**스레드**: 순회 방법에 따른 방문순서를 유지하는 포인터

스레드는 오른쪽 스레드와 왼쪽 스레드 두 가지 존재:

- **오른쪽 스레드**: 정해진 순회 순서에 따른 그 노드의 후속 노드를 가리킴
- **왼쪽 스레드**: 그 노드의 선행 노드를 가리킴

### 스레드 트리의 특징

이렇게 스레드를 2개 유지하려면 노드의 삽입과 삭제가 무척 복잡하고 기억장소를 낭비할 수도 있음. 꼭 필요한 경우가 아니라면 후속 스레드를 사용하는 방법 사용.

이진 트리 순회 방법에 세 가지 존재:
1. **전위 순회**: + * 2 3 4
2. **중위 순회**: 2 * 3 + 4  
3. **후위 순회**: 2 3 * 4 +

스레드 트리는 그중에서 어떤 한 가지 방법을 적용했을 때의 순서를 유지. 필요하다면 다중 스레드를 사용하여 모든 순회에 따른 순서를 유지하는 스레드 트리 구성 가능.

### 스레드 트리 예시

<details>
<summary>그림 8-1 트리 예</summary>

```
      +
     / \
    *   4
   / \
  2   3
```

이 트리 존재.

</details>

<details>
<summary>그림 8-2 세 가지 순회에 대한 스레드 트리</summary>

**(a) 전위 순회 스레드 트리**: +*234
- 전위 순회 순서에 따라 스레드가 연결됨

**(b) 중위 순회 스레드 트리**: 2*3+4  
- 중위 순회 순서에 따라 스레드가 연결됨

**(c) 후위 순회 스레드 트리**: 23*4+
- 후위 순회 순서에 따라 스레드가 연결됨

</details>

---

## 2. 스레드 트리 구현

### 스레드의 구현 방법(1): 포인터 필드의 추가

#### 포인터 필드의 추가
스레드를 저장하는 포인터를 추가하는 것

✓ **왼쪽 스레드 포인터, 왼쪽 자식 포인터, 데이터, 오른쪽 자식 포인터, 오른쪽 스레드 포인터** 필드로 노드 구조를 정의함

- **오른쪽 스레드**: 정해진 순회 순서에 따른 그 노드의 후속 노드를 가리키고
- **왼쪽 스레드**: 그 노드의 선행 노드를 가리킴

#### 노드 구조체 정의

```c
typedef struct tfNode{ 
    struct tfnode *left;
    struct tfnode *lthread; 
    char data; 
    struct tfnode *right; 
    struct tfnode *rthread;
} tfnode;
```

#### 추가된 포인터 필드를 이용한 중위 순회 연산

**스택을 운영하지 않고도 트리에 속한 모든 노드를 순회할 수 있음**

**하지만 스레드를 위해 추가 기억장소를 사용한다는 부담이 생김**

<details>
<summary>중위 순회 알고리즘 코드</summary>

```c
void inorder(tfNode *startNode) { 
    tfNode *ptr ;
    ptr = startNode;
    while(ptr ! = NULL) { 
        printf("%c", ptr → data); 
        ptr = ptr → rthread ; 
    }
}
```

**중위 순회 연산과정:**

1) `inorder()`: 순회할 트리의 시작 노드를 가리키는 포인터 startNode를 매개변수로 하는 함수의 이름을 inorder()로 함

2) 노드를 가리킬 수 있는 (tfNode) 타입의 포인터 ptr을 생성하여 시작 노드를 가리키도록 함

3) 포인터 ptr이 가리키는 데이터 항목을 출력하고 ptr을 ptr의 오른쪽 스레드 값으로 바꾸어(ptr→rthread) 중위 순회에 따른 다음 노드를 가리키도록 수정

4) 이 과정을 ptr이 NULL이 될 때까지 반복

</details>

### 스레드의 구현 방법(2): 빈 포인터의 활용

#### 노드의 빈 포인터 필드의 활용
기존 이진 트리의 노드 구조를 그대로 사용하면서, **노드에 있는 사용하지 않는 포인터(빈 포인터)를 활용하는 방법**

#### 추가 기억장소를 사용하지 않아도 되는 장점 존재

#### 어떤 노드 X에 대해 오른쪽 포인터가 NULL이면 이 포인터를 노드 X의 후행 노드를 가리키도록 함

#### 왼쪽 포인터가 NULL이면 노드 X의 선행 노드를 가리키도록 함

### 잎 노드의 빈 포인터 필드의 활용

✓ **이진 트리의 포인터 개수** (노드의 개수를 n개라 가정함):
  - 왼쪽 서브트리를 가리키는 포인터 n개 + 오른쪽 서브트리를 가리키는 포인터 n개
  ⇒ **2n개의 포인터**

✓ **루트 노드를 제외한 각 노드 개수는 모두 진입 차수가 1이 되므로,**

✓ **루트 노드를 제외한 전체 노드 개수, 즉, 누군가로부터 가리켜져야 할 노드의 개수: n-1**

✓ **(각 노드의) NULL이 아닌 포인터 개수: n-1**  

✓ **2n-(n-1)=n+1개의 NULL 포인터가 노드에 존재함**

### 각 노드에 대해 포인터가 스레드로 사용 중인지 아니면 서브트리에 대한 포인터인지 구분하기 위해 **스레드 사용여부 태그 필드가 필요함** (삽입/삭제 연산에서 반드시 필요함)

### 전위 순회: 각 노드의 오른쪽 포인터 필드를 스레드로 사용하는 제한을 가정함

✓ **어떤 노드의 오른쪽 포인터가 실제 오른쪽 자식을 가리키면(실선) 그대로 두고,**

✓ **NULL이면 전위 순회로 순회할 때 다음으로 순회되는 노드(후행 노드)를 가리키도록(점선) 지정함**

#### 전위 순회 예시

**((A+B)*(C/D)+E%F)/G의 이진 트리 표현**

복잡한 트리에서 전위 순회와 중위 순회, 후위 순회의 스레드 연결 방식을 보여주는 상세한 다이어그램 제공.

<details>
<summary>전위 순회 스레드 트리 예시</summary>

**스레드를 이용한 전위 순회 #1**
startNode에서 시작하여 / + * + A B / C D % E F G 순서로 순회
전위 순회 결과: **/ + * + A B / C D % E F G**

**스레드를 이용한 전위 순회 #2**  
전위 순회 결과: **/ + * + A B / C D % E F G**

</details>

<details>
<summary>중위 순회 스레드 트리 예시</summary>

**스레드를 이용한 중위 순회 #1**
중위 순회 결과: **A + B * C / D + E % F / G**

**스레드를 이용한 중위 순회 #2**
중위 순회 결과: **A + B * C / D + E % F / G**

</details>

<details>
<summary>후위 순회 스레드 트리 예시</summary>

**스레드를 이용한 후위 순회**
후위 순회 결과: **A B + C D / * E F % + G /**

</details>

---

## 3. 스레드 트리 순회, 삽입, 삭제

### 중위순회스레드 트리

#### 중위 순회 스레드 트리의 중위 순회 연산

<details>
<summary>노드 구조체와 순회 함수</summary>

```c
typedef struct thNode {
    struct tfNode *left ;
    char data ;
    struct tfNode *right ;
    int threadFlag ;
} tfNode ;

void inorder(tfNode* root) {
    tfNode* ptr = inorderStart(root) ;
    while(ptr != NULL) {
        printf("%c ", ptr → data) ;
        if(ptr → threadFlag) //오른쪽포인터를 스레드로 사용함
            ptr = ptr → right ;
        else
            ptr = inorderStart(ptr → right) ; } }

tfNode* inorderStart(tfNode* ptr) {
    if(ptr == NULL)
        return NULL ;
    while(ptr → left != NULL)
        ptr = ptr → left ;
    return ptr ;
}
```

</details>

### 스레드트리삽입연산

#### 중위 순회 스레드 트리의 노드 삽입 연산(1)

<details>
<summary>노드 삽입 구조체 정의</summary>

```c
typedef struct tfNode {
    struct tfnode *left ;
    struct tfnode *lthread ;
    char data ;
    struct tfnode *right ;
    struct tfnode *rthread ;
} tfnode ;
```

</details>

#### 중위 순회 스레드 트리의 노드 삽입 연산(1): 노드 x가 잎 노드인 경우

<details>
<summary>삽입 알고리즘</summary>

```c
void insert(tfNode *x, tfNode *ttree) {
    ttree → left = NULL ;
    ttree → right = x → right ;
    ttree → lthread = x ;
    ttree → rthread = x → rthread ;
    x → right = ttree ;
    x → rthread = ttree ;
}
```

</details>

#### 중위 순회 스레드 트리의 노드 삽입 연산(2): 노드 x가 내부 노드인 경우

<details>
<summary>삽입 과정 6단계</summary>

1) 삽입되는 노드 Y의 왼쪽 포인터를 NULL로 설정

2) 삽입되는 노드 Y의 오른쪽 포인터는 노드 X의 오른쪽 포인터 값으로 설정

3) 삽입되는 노드 Y의 왼쪽 스레드 포인터가 X를 가리키도록 설정

4) 삽입되는 노드 Y의 오른쪽 스레드가 노드 X의 오른쪽 스레드와 같게 설정

5) 노드 X의 오른쪽 포인터가 노드 Y를 가리키도록 설정

6) 노드 X의 오른쪽 스레드가 노드 Y를 가리키도록 설정

</details>

### 스레드트리삭제연산

#### 스레드 트리의 내부 노드 삭제: 삭제된 노드의 자식 노드를 처리 방법이 필요함

1) **노드의 자식 노드를 모두 삭제하는 방법**

2) **삭제하려는 노드 X의 왼쪽 서브 트리나 오른쪽 서브 트리의 루트를 X가 있던 위치로 옮기는 방법**

3) **잎 노드가 아닌 노드를 삭제하지 못하게 하는 것**

---

## 정리하기

- **스레드(thread)**: 정해진 순회 방법에 따른 방문 순서를 유지하는 포인터
- **스레드 트리**: 스레드라는 포인터를 갖는 이진 트리
- **오른쪽 스레드**: 정해진 순회 순서에 따른 그 노드의 후속 노드를 가리킴
- **왼쪽 스레드**: 그 노드의 선행 노드를 가리킴
- **이진 트리의 NULL 포인터 개수**: 2n - (n-1) = n+1 개

---

## Summary | 요약

1. **정해진 순회 방법에 따른 방문 순서를 유지하는 스레드(thread)라는 포인터를 갖는 이진 트리를 스레드 트리**

2. **오른쪽 스레드는 정해진 순회 순서에 따른 그 노드의 후속 노드를 가리키고, 왼쪽 스레드는 그 노드의 선행 노드를 가리킴**

3. **스레드를 구현할 때 스레드를 저장하는 포인터를 추가하는 방법 존재**

4. **스레드를 구현하는 다른 방법은 이진 트리를 위한 연결 리스트의 노드 구조를 그대로 사용하면서, 잎 노드에 있는 사용하지 않는 포인터를 활용하는 방법**

5. **n개의 노드를 가진 이진 트리를 연결 리스트로 구현할 때, NULL 포인터는 항상 2n-(n-1)=n+1개가 존재**

6. **잎 노드에 있는 포인터를 활용할 때는 각 노드에 대해 포인터가 스레드로 사용 중인지 아니면 서브트리에 대한 포인터인지 구분하기 위해 하나 혹은 두 개의 플래그 필드를 사용**
